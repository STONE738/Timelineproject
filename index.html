<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timeline Calculator</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      -webkit-user-select: none; /* Safari */
      -ms-user-select: none; /* IE 10+ */
      user-select: none; /* Standard syntax */
    }
    label {
      -webkit-user-select: none; /* Safari */
      -ms-user-select: none; /* IE 10+ */
      user-select: none; /* Standard syntax */
    }
    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: flex-start; /* Canh lề trái */
    }
    .field {
      flex: 1;
      min-width: 150px;
    }
    select, input[type="number"] {
      width: 100%;
      max-width: 150px; /* Thu nhỏ ô nhập */
      padding: 8px;
    }
    .scope-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
      justify-content: flex-start; /* Canh lề trái */
      margin-left: 0; /* Đảm bảo không có margin mặc định */
      text-align: left; /* Canh trái văn bản */
    }
    .scope-item {
      display: flex;
      gap: 4px;
      justify-content: flex-start; /* Canh lề trái */
      margin-left: 0; /* Đảm bảo không có margin mặc định */
      text-align: left; /* Canh trái văn bản */
    }
    .scope-details {
      margin-left: 20px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      justify-content: flex-start; /* Canh lề trái */
      margin-left: 0; /* Đảm bảo không có margin mặc định */
      text-align: left; /* Canh trái văn bản */
    }
    .scope-detail {
      display: flex;
      gap: 8px;
      justify-content: flex-start; /* Canh lề trái */
      margin-left: 0; /* Đảm bảo không có margin mặc định */
      text-align: left; /* Canh trái văn bản */
    }
    .scope-label {
      margin-left: 0; /* Đảm bảo không có margin mặc định */
      text-align: left; /* Canh trái văn bản */
    }
    .contract-value {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .contract-value span {
      font-size: 14px;
      color: #666;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      justify-content: flex-start; /* Canh lề trái */
    }
    .tab-btn {
      padding: 8px 12px;
      background: #f0f0f0;
      color: black;
      cursor: pointer;
      border-radius: 4px;
    }
    .tab-btn.active {
      background: #007bff;
      color: white;
    }
    iframe {
      width: 100%;
      height: 60vh;
      border: none;
      margin-top: 12px;
    }
    @media (max-width: 414px) {
      .container {
        padding: 8px;
      }
      h1 {
        font-size: 20px;
      }
      .row {
        flex-direction: column;
      }
      .tabs {
        flex-direction: column;
      }
      iframe {
        height: 50vh;
      }
      select, input[type="number"] {
        max-width: 120px; /* Thu nhỏ hơn trên mobile */
      }
      .contract-value span {
        font-size: 12px;
        color: #666; /* Màu chữ xám để rõ ràng */
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Nhập thông tin dự án</h1>
    <div class="card">
      <div class="row">
        <div class="field">
          <label>Diện tích tổng (m²)</label>
          <input type="number" id="totalArea" placeholder="Nhập diện tích" min="1" value="0">
        </div>
        <div class="field">
          <label>Loại công trình</label>
          <select id="buildingType">
            <option value="nhapho" selected>Nhà phố</option>
            <option value="canho">Căn hộ</option>
            <option value="bietthu">Biệt thự</option>
            <option value="dichvu">Dịch vụ</option>
            <option value="shophouse">Shophouse</option>
            <option value="vanphong">Văn phòng</option>
          </select>
        </div>
        <div class="field">
          <label>Phong cách thiết kế</label>
          <select id="designStyle">
            <option value="hiendai" selected>Hiện đại</option>
            <option value="bancodien">Bán cổ điển</option>
            <option value="luxury">Luxury</option>
            <option value="minimalism">Minimalism / Scandinavian</option>
            <option value="indochine">Indochine</option>
            <option value="codienchauau">Cổ điển châu Âu</option>
            <option value="khac">Khác</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>Số tầng</label>
          <input type="number" id="floorNumber" min="1" value="1">
        </div>
      </div>
      <div class="row">
        <div class="field full-width">
          <label>Phạm vi công việc</label>
          <div class="scope-section">
            <div class="scope-item">
              <label class="scope-label"><input type="checkbox" id="scopeFitout"> Fitout</label>
              <div class="scope-details">
                <label class="scope-detail"><span class="label-text">Số lượng WC</span><input type="number" id="wcCount" min="0" value="0"></label>
              </div>
            </div>
            <div class="scope-item">
              <label class="scope-label"><input type="checkbox" id="scopeFur"> Fur</label>
              <div class="scope-details">
                <label class="scope-detail"><span class="label-text">Số lượng PN</span><input type="number" id="bedroomCount" min="0" value="0"></label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>Giá trị HĐ Fitout (triệu VNĐ)</label>
          <div class="contract-value">
            <input type="number" id="fitoutContractValue" min="0" value="0">
            <span id="fitoutContractConverted"></span>
          </div>
        </div>
        <div class="field">
          <label>Giá trị HĐ Fur (triệu VNĐ)</label>
          <div class="contract-value">
            <input type="number" id="furContractValue" min="0" value="0">
            <span id="furContractConverted"></span>
          </div>
        </div>
        <div class="field">
          <label>Loại thi công</label>
          <select id="constructionType">
            <option value="new">Làm mới</option>
            <option value="renovation">Cải tạo</option>
          </select>
        </div>
      </div>
    </div>

    <div class="tabs" role="tablist">
      <div class="tab-btn active" data-src="timeline-2d.html" role="tab">Thời Gian TK 2D</div>
      <div class="tab-btn" data-src="timeline-construction.html" role="tab">Thời Gian Thi công</div>
      <div class="tab-btn" data-src="project-data.html" role="tab">Dữ liệu dự án</div>
    </div>

    <main>
      <iframe id="content-frame" src="timeline-2d.html" title="Nội dung timeline"></iframe>
    </main>
  </div>

  <script>
    const tabs = document.querySelectorAll('.tab-btn');
    const frame = document.getElementById('content-frame');
    let currentData = {};

    function getData() {
      return {
        totalArea: parseFloat(document.getElementById('totalArea').value) || 0,
        buildingType: document.getElementById('buildingType').value,
        designStyle: document.getElementById('designStyle').value,
        scopeFitout: document.getElementById('scopeFitout').checked,
        scopeFur: document.getElementById('scopeFur').checked,
        wcCount: parseInt(document.getElementById('wcCount').value) || 0,
        bedroomCount: parseInt(document.getElementById('bedroomCount').value) || 0,
        fitoutContractValue: parseFloat(document.getElementById('fitoutContractValue').value) || 0,
        furContractValue: parseFloat(document.getElementById('furContractValue').value) || 0,
        constructionType: document.getElementById('constructionType').value,
        floorNumber: parseInt(document.getElementById('floorNumber').value) || 1
      };
    }

    function updateContractValues() {
      const fitoutValue = parseFloat(document.getElementById('fitoutContractValue').value) || 0;
      const furValue = parseFloat(document.getElementById('furContractValue').value) || 0;

      document.getElementById('fitoutContractConverted').textContent = fitoutValue > 1000 ? `~${(fitoutValue / 1000).toFixed(1)} tỷ` : '';
      document.getElementById('furContractConverted').textContent = furValue > 1000 ? `~${(furValue / 1000).toFixed(1)} tỷ` : '';
    }

    function sendData() {
      currentData = getData();
      if (frame.contentWindow) {
        frame.contentWindow.postMessage(currentData, '*');
      }
      updateContractValues();
    }

    const buildingTypeSelect = document.getElementById('buildingType');
    const floorInput = document.getElementById('floorNumber');
    function toggleFloorInput() {
      if (buildingTypeSelect.value === 'canho') {
        floorInput.disabled = true;
        floorInput.value = 1;
      } else {
        floorInput.disabled = false;
      }
      sendData();
    }

    buildingTypeSelect.addEventListener('change', toggleFloorInput);
    toggleFloorInput(); // Gọi ngay để áp dụng mặc định

    tabs.forEach(tab => tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const src = tab.dataset.src;
      frame.onload = () => sendData();
      frame.src = src;
    }));

    document.querySelectorAll('input, select').forEach(input => {
      input.addEventListener('change', sendData);
      input.addEventListener('input', sendData);
    });

    sendData();
  </script>
</body>
</html>